name: E2E-Test Backend Deployment

on:
  workflow_dispatch:
    inputs:
      server:
        description: "서버 선택 (27=dev, 26=stage, 195=prod)"
        required: true
        type: choice
        options: ["27", "26", "195"]

jobs:
  e2e-test:
    uses: SYSTRAN-KOREA-AI/.github/.github/workflows/deploy-spring-template.yml@main
    with:
      SERVICE_NAME: e2e-test
      BASE_REMOTE_PATH: /opt/business_meeting
      PROFILE: ${{ (github.event.inputs.server == '27' && 'dev') || (github.event.inputs.server == '26' && 'stage') || (github.event.inputs.server == '195' && 'prod') }}
    secrets:
      # Pass all potential config secrets
      APP_DEV_YML: ${{ secrets.APP_DEV_YML }}
      APP_STAGE_YML: ${{ secrets.APP_STAGE_YML }}
      APP_PROD_YML: ${{ secrets.APP_PROD_YML }}
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      SERVER_HOST: ${{ github.event.inputs.server == '195' && secrets.SERVER_195_HOST || github.event.inputs.server == '26' && secrets.SERVER_26_HOST || secrets.SERVER_27_HOST }}
      SERVER_PORT: ${{ github.event.inputs.server == '195' && secrets.SERVER_195_PORT || github.event.inputs.server == '26' && secrets.SERVER_26_PORT || secrets.SERVER_27_PORT }}
      SERVER_USER: ${{ github.event.inputs.server == '195' && secrets.SERVER_195_USER || github.event.inputs.server == '26' && secrets.SERVER_26_USER || secrets.SERVER_27_USER }}
      BASE64_KEY: ${{ github.event.inputs.server == '195' && secrets.SERVER_195_KEY || github.event.inputs.server == '26' && secrets.SERVER_26_KEY || secrets.SERVER_27_KEY }}